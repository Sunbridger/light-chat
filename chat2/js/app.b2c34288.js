(function(e){function t(t){for(var r,i,s=t[0],c=t[1],u=t[2],f=0,d=[];f<s.length;f++)i=s[f],a[i]&&d.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(d.length)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={app:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://sunbridger.github.io/chat2/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0889":function(e,t,n){"use strict";var r=n("2af3"),a=n.n(r);a.a},1:function(e,t){},"2af3":function(e,t,n){},"355d2":function(e,t,n){},"3bb5":function(e,t,n){"use strict";var r=n("355d2"),a=n.n(r);a.a},"41a6":function(e,t,n){},"5c48":function(e,t,n){},"66c0":function(e,t,n){"use strict";var r=n("c0c8"),a=n.n(r);a.a},"7c55":function(e,t,n){"use strict";var r=n("5c48"),a=n.n(r);a.a},c0c8:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},o=[],i=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),s=(n("7f7f"),n("a481"),n("bc3a")),c=n.n(s),u=n("8055"),l=n.n(u),f="https://2261295nz5.51mypc.cn/",d=f,m=l()(d.replace("http","ws"));console.log(m,"io");var p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.a.post("/api"+e,t)},h=function(e,t,n){m.emit(e,t,n)},g=function(e,t){m.on(e,t)},v=n("2f62");function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach(function(t){Object(i["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y={data:function(){return{audioCtx:new AudioContext}},created:function(){var e=this,t=window.localStorage.uid;t&&g("receive-private-chat",function(n){if(e.audioTip(),"chat"!==e.$route.name){var r=t+"-"+n.uid,a=e.getStroage(r)||0;a?e.$message({message:"".concat(n.name,"发来一条新消息"),type:"success"}):(e.saveStroage(Object(i["a"])({},r,++a)),location.reload())}else e.getShouldShowMsg({uid1:t,uid2:n.uid}),window.scrollTo({top:window.screen.height+9999,behavior:"smooth"})})},computed:{},methods:w({},Object(v["b"])(["getShouldShowMsg"]),{audioTip:function(){var e=this.audioCtx,t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.type="sine",t.frequency.value=600,n.gain.setValueAtTime(0,e.currentTime),n.gain.linearRampToValueAtTime(2,e.currentTime+.01),t.start(e.currentTime),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+1),t.stop(e.currentTime+1)}})},O=y,S=(n("7c55"),n("2877")),j=Object(S["a"])(O,a,o,!1,null,null,null),x=j.exports,_=n("8c4f"),P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pg-login"},[n("el-form",{ref:"form",attrs:{model:e.form,"label-width":"60px"}},[n("el-form-item",{attrs:{label:"账号"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"密码"}},[n("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"success"},on:{click:e.login}},[e._v("登陆")]),n("el-button",{attrs:{type:"primary"}},[n("router-link",{attrs:{to:{name:"register"}}},[e._v("注册")])],1)],1)],1)],1)},k=[],$={name:"login",data:function(){return{form:{name:"",password:""}}},methods:{login:function(){var e=this;this.form.name.trim()&&this.form.password.trim()?p("/login",this.form).then(function(t){var n=t.data;if(n.status){var r=n.uid,a=n.avatar,o=n.name;e.saveStroage({uid:r,avatar:a,name:o}),e.$router.push({name:"home"})}else e.$message({message:n.msg,type:"error",duration:1500})}):this.$message({message:"请填写账号或密码",type:"warning",duration:1500})}}},C=$,M=(n("66c0"),Object(S["a"])(C,P,k,!1,null,null,null)),T=M.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pg-form"},[n("el-form",{ref:"form",attrs:{model:e.form,"label-width":"60px",rules:e.rules}},[n("el-form-item",{attrs:{label:"账号",prop:"name"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),n("el-form-item",{attrs:{label:"头像"}},[n("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.serviceImg,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.urlImg?n("img",{staticClass:"avatar",attrs:{src:e.urlImg}}):n("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),n("el-form-item",[n("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary",plain:""},on:{click:function(t){return e.onRegister("form")}}},[e._v("提交")])],1)],1)],1)},N=[],A=d+"addimg",D={name:"register",data:function(){return{form:{name:"",password:"",avatar:""},rules:{name:[{required:!0,message:"请输入账号名称",trigger:"blur"},{min:3,max:10,message:"长度在 3 到 10 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},urlImg:"",fullscreenLoading:!1,serviceImg:A}},methods:{onRegister:function(e){var t=this;this.$refs[e].validate(function(e){e?t.registerFn():t.$message({message:"请按要求填写信息",type:"warning",duration:1500})})},registerFn:function(){var e=this;p("/register",this.form).then(function(t){var n=t.data;e.fullscreenLoading=!1,n.msg?(e.$message({message:"注册成功",type:"success",duration:450}),e.$router.push({name:"login"})):e.$message({message:"用户名已存在",type:"error",duration:1500})})},handleAvatarSuccess:function(e,t){this.form.avatar=this.service+e.url,this.urlImg=URL.createObjectURL(t.raw)},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png",n=e.size/1024/1024<2;return t||this.$message.error("只支持jpeg|png格式图片"),n||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&n}}},F=D,R=(n("ddb4"),Object(S["a"])(F,E,N,!1,null,null,null)),U=R.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"fix-top"},[n("i",{staticClass:"el-icon-arrow-left",on:{click:e.goBack}}),e._v("\n        "+e._s(e.friend.name)+"\n    ")]),n("div",{staticClass:"content-top"},e._l(e.shouldShowMsg,function(t){return n("div",{key:t.id,staticClass:"row-msg"},[n("p",{staticClass:"top-msg",class:{fr:e.byme(t.fromuid),fl:!e.byme(t.fromuid)}},[t.loading&&e.byme(t.fromuid)?n("i",{staticClass:"el-icon-loading"}):e._e(),e._v("\n                "+e._s(t.msg)+"\n                "),n("el-avatar",{class:{"el-avatar-fl":!e.byme(t.fromuid),"el-avatar-fr":e.byme(t.fromuid)},attrs:{src:e.byme(t.fromuid)?e.myAvatar:e.friend.avatar}})],1)])}),0),n("div",{staticClass:"box-chat"},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:4}},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}),n("el-button",{attrs:{size:"small",type:"success",round:""},on:{click:e.submit}},[e._v("发送")])],1)])},L=[];function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach(function(t){Object(i["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var q={name:"chat",data:function(){return{content:"",friend:this.$route.params,myAvatar:this.getStroage("avatar"),myName:this.getStroage("name"),myUid:this.getStroage("uid")}},computed:{shouldShowMsg:function(){return this.$store.state.shouldShowMsg}},created:function(){this.getmsgoto(),this.clearNum()},methods:B({},Object(v["b"])(["getShouldShowMsg"]),{},Object(v["c"])(["changeShouldShowMsg"]),{clearNum:function(){var e=this.myUid+"-"+this.friend.uid;window.localStorage.removeItem(e)},getmsgoto:function(){this.getShouldShowMsg({uid1:this.myUid,uid2:this.friend.uid})},byme:function(e){return e==this.myUid},submit:function(){var e=this;if(this.content){console.log(this.myUid,"asdasd");var t=this.content;this.content="";var n={uid:this.myUid,msg:t,name:this.myName};this.changeShouldShowMsg({fromuid:this.myUid,avatar:this.avatar,msg:t,loading:!0}),this.autoBottom(),p("/savemsg",{from:this.myUid,to:this.friend.uid,msg:t}).then(function(t){var r=t.data;r&&(e.getmsgoto(),h("send-private-chat",n,e.friend.uid))})}},autoBottom:function(){window.scrollTo({top:window.screen.height+9999,behavior:"smooth"})},goBack:function(){this.$router.push({name:"home"})}})},V=q,J=(n("3bb5"),Object(S["a"])(V,I,L,!1,null,null,null)),W=J.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"nav-top"},[n("p",{staticClass:"nav-p-t"},[e._v("\n            欢迎您"),n("span",[e._v(e._s(e.title))])]),n("p",{staticClass:"nav-p",on:{click:e.exit}},[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)]),"friends"===e.tabName?n("div",{staticClass:"content-box"},e._l(e.friends,function(t){return n("div",{key:t.uid,staticClass:"flex",on:{click:function(n){return e.getChat(t)}}},[n("el-badge",{staticClass:"item",attrs:{hidden:e.getNum(t.uid),"is-dot":""}},[n("el-avatar",{attrs:{shape:"square",size:50,src:t.avatar}})],1),n("p",{staticClass:"flex1"},[e._v(e._s(t.name))]),e.onlineFn(t.uid)?n("p",{staticClass:"font-grenn"},[e._v("在线")]):n("p",{staticClass:"font-red"},[e._v("离线")])],1)}),0):e._e(),"xxx"===e.tabName?n("div",[e._v("\n        ...开发中\n    ")]):e._e(),n("div",{staticClass:"nav-bottom"},e._l(e.item,function(t,r){return n("p",{key:r,staticClass:"nav-p",class:{active:t.active},on:{click:function(n){return e.tabSelect(r,t.tabName)}}},[n("i",{class:t.icon}),e._v(e._s(t.value)+"\n        ")])}),0)])},H=[];n("6762"),n("2fdb");function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(n,!0).forEach(function(t){Object(i["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var X=[{value:"我的好友",active:!0,icon:"el-icon-user-solid",tabName:"friends"},{value:"待开发",active:!1,icon:"el-icon-upload",tabName:"xxx"}],Y={name:"home",data:function(){return{item:Object.assign([],X),tabName:"friends",value:"",onlineFriends:[],uid:window.localStorage.uid,title:window.localStorage.name}},computed:{friends:function(){return this.$store.state.friends}},created:function(){h("online",this.uid),this.getFriends({uid:this.uid}),this.getWhoOnline()},methods:Q({},Object(v["b"])(["getFriends"]),{getNum:function(e){var t=this.uid+"-"+e,n=this.getStroage(t);return!n},getWhoOnline:function(){var e=this;p("/whoOnline",{uid:this.uid}).then(function(t){var n=t.data;e.onlineFriends=n})},exit:function(){["avatar","name","uid"].forEach(function(e){window.localStorage.removeItem(e)}),h("offline",this.uid),this.$router.push({name:"login"})},tabSelect:function(e,t){this.item.forEach(function(t,n){t.active=n===e}),this.tabName=t},getChat:function(e){this.$router.push({name:"chat",params:e})},onlineFn:function(e){return this.onlineFriends.includes(e)}})},Z=Y,ee=(n("0889"),Object(S["a"])(Z,G,H,!1,null,null,null)),te=ee.exports;r["default"].use(_["a"]);var ne=new _["a"]({mode:"hash",base:"https://sunbridger.github.io/chat2/",routes:[{path:"/",name:"index",redirect:{name:"login"}},{path:"/login",name:"login",component:T},{path:"/register",name:"register",component:U},{path:"/home",name:"home",component:te},{path:"/chat",name:"chat",component:W}]});ne.beforeEach(function(e,t,n){console.log(e,t,"-"),window.localStorage.uid?"chat"==e.name&&e.params.uid?(n(),setTimeout(function(){window.scrollTo({top:window.screen.height+9999,behavior:"smooth"})},500)):"home"==e.name?n():n({name:"home"}):"login"==e.name||"register"==e.name?n():n({name:"login"})});var re=ne,ae=(n("96cf"),n("3b8d"));r["default"].use(v["a"]);var oe=[],ie=[],se=new v["a"].Store({state:{friends:ie,shouldShowMsg:oe},mutations:{changeFriends:function(e,t){e.friends=Object.assign([],t)},changeShouldShowMsg:function(e,t){Array.isArray(t)?(e.shouldShowMsg=Object.assign([],t),console.log(e.shouldShowMsg,"state.shouldShowMsg")):e.shouldShowMsg.push(t)}},actions:{getFriends:function(){var e=Object(ae["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:p("/getuser",{uid:n.uid}).then(function(e){t.commit("changeFriends",e.data)});case 1:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}(),getShouldShowMsg:function(){var e=Object(ae["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:p("/getmsgoto",{uid1:n.uid1,uid2:n.uid2}).then(function(e){t.commit("changeShouldShowMsg",e.data)});case 1:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}()}}),ce=(n("be4f"),n("450d"),n("896a")),ue=n.n(ce),le=(n("0fb7"),n("f529")),fe=n.n(le),de=(n("e960"),n("b35b")),me=n.n(de),pe=(n("e2f3"),n("06f9")),he=n.n(pe),ge=(n("f225"),n("89a9")),ve=n.n(ge),be=(n("b5d8"),n("f494")),we=n.n(be),ye=(n("fe07"),n("6ac5")),Oe=n.n(ye),Se=(n("eca7"),n("3787")),je=n.n(Se),xe=(n("425f"),n("4105")),_e=n.n(xe),Pe=(n("186a"),n("301f")),ke=n.n(Pe),$e=(n("96dc"),n("9cea")),Ce=n.n($e),Me=(n("920a"),n("4f0c")),Te=n.n(Me),Ee=(n("10cb"),n("f3ad")),Ne=n.n(Ee),Ae=(n("1951"),n("eedf")),De=n.n(Ae);r["default"].use(De.a),r["default"].use(Ne.a),r["default"].use(Te.a),r["default"].use(Ce.a),r["default"].use(ke.a),r["default"].use(_e.a),r["default"].use(je.a),r["default"].use(Oe.a),r["default"].use(we.a),r["default"].use(ve.a),r["default"].use(he.a),r["default"].use(me.a),r["default"].prototype.$message=fe.a,r["default"].use(ue.a.directive),r["default"].config.productionTip=!1,r["default"].prototype.service=d,r["default"].prototype.saveStroage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)window.localStorage[t]=e[t]},r["default"].prototype.getStroage=function(e){return window.localStorage[e]},new r["default"]({router:re,store:se,render:function(e){return e(x)}}).$mount("#app")},ddb4:function(e,t,n){"use strict";var r=n("41a6"),a=n.n(r);a.a}});
//# sourceMappingURL=app.b2c34288.js.map